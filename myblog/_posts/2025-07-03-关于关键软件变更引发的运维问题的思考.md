---
layout: post
title: "关于关键软件变更引发的运维问题的思考"
date: 2025-07-03 14:09:15 +0800
categories: []
tags: []
image: assets/img/app_fault_20250703.png
math: false
toc: true
published: true
related: false
pin: false
---

# 事件描述

- 操作系统进行漏洞修复，升级了系统内核和一部分组件，其中openjdk部署在了新的目录（newopenjdk），并删除了原有的目录（oldopenjdk）。
- 应用程序启动时，提示jdk路径不存在（oldopenjdk）
- JAVA_HOME的环境变量指向oldopenjdk

# 事件处置

- 方案1-建立软连接，将newopenjdk软连接到oldopenjdk
  - 优点：方案简单，操作一致性高，便于批量实施
  - 缺点：由于路径中包含版本信息，后期管理中可能出现歧义
- 方案2-修改各个环境变量，修改程序配置的变量
  - 优点: 针对方案1的缺点, 避免了后期管理中可能出现的歧义
  - 缺点: 工作量巨大, 上百套系统的环境变量配置方式不一致, 有的从root用户继承, 有的在自己的profile中配置,有的配置在启动脚本中等等, 需要针对每个系统检查确认后再制定变更方案,只能单独实施,变更操作的风险高于方案1 

- ***使用方案1解决问题***

# 反思

- 系统建设阶段应该规范基础软件路径, 避免后期变更环境变量, 更新基础软件后, 软链指向新版本,同时保留老版本,在出现问题后便于回退
- 启动应用时需要使用的环境变量, 尽量统一规范
- 对于非标准配置, 部署过程中应该有智能化的记录方式,比如借助AI自动总结部署过程, 生成runbook


